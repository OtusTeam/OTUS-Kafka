# MirrorMaker2: копирование данных топика из одного кластера во второй.

1) Запускаем сервисы
docker compose up -d
docker compose ps -a

2) Проверяем список топиков на первом кластере
docker exec -ti kafka1 /usr/bin/kafka-topics --list --bootstrap-server kafka1:9092

3) Создаём топик topic-to-copy на первом кластере
docker exec -ti kafka1 /usr/bin/kafka-topics --create --bootstrap-server kafka1:9092 --replication-factor 1 --partitions 4 --topic topic-to-copy

4) Выводим описание топика
docker exec -ti kafka1 /usr/bin/kafka-topics --describe --bootstrap-server kafka1:9092

5) Отправляем данные в топик topic-to-copy на первом кластере
docker exec -ti kafka1 /usr/bin/kafka-console-producer --bootstrap-server kafka1:9092 --topic topic-to-copy
one
two
three
four
five
^D

6) Проверим содержимое топика на первом кластере
docker exec -ti kafka1 /usr/bin/kafka-console-consumer --topic topic-to-copy --bootstrap-server kafka1:9092 --from-beginning --property print.offset=true --property print.partition=true
^C

7) Проверяем список топиков на втором кластере
docker exec -ti kafka1-m /usr/bin/kafka-topics --list --bootstrap-server kafka1-m:9092

8) Запускаем MirrorMaker2 на втором кластере
docker exec -ti kafka1-m /bin/bash
/usr/bin/connect-mirror-maker -daemon /tmp/config/mm.properties
jps
jps -v
^D

9) Проверяем список топиков на втором кластере
docker exec -ti kafka1-m /usr/bin/kafka-topics --list --bootstrap-server kafka1-m:9092

10) Открываем два терминала
tmux
^B%

11) В первом терминале проверяем содержимое топика на втором кластере
docker exec -ti kafka1-m /usr/bin/kafka-console-consumer --topic src.topic-to-copy --bootstrap-server kafka1-m:9092 --from-beginning --property print.offset=true --property print.partition=true

12) Во втором терминале отправляем данные в топик topic-to-copy на первом кластере
docker exec -ti kafka1 /usr/bin/kafka-console-producer --bootstrap-server kafka1:9092 --topic topic-to-copy
2-one
2-two
2-three
2-four
2-five
^D

13) Останавливаем чтение из топика в первом терминале
^C

14) Закрываем терминалы
^Bxy^Bxy

15) Останавливаем сервисы
docker compose down
docker container prune -f
docker volume prune -f
